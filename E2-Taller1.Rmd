---
title: "TALLER: Tutorial R – Distribuciones muestrales e intervalos de confianza"
output: html_notebook
---

## 1. Funciones en R
Para construir funciones en R es necesario seguir la siguiente estructura:
```{r}
nombre_de_funcion <- function(par1, par2, ...) {
  cuerpo
  return(resultado)
}
```
Dichas funciones se pueden usar digitando su nombre seguido de los parámetros entre paréntesis, son usadas para encapsular código que se usará constantemente y a pesar de no retornar más de un valor, es posible crear una lista de diferentes salidas y retornarla, como se mostrará a continuación en el caso de la función iqr(v), que recibe como entrada un vector de valores numéricos y dentro calcula el primer y tercer cuartil (0.25 y 0.75) haciendo uso de la función predefinida de R, quantile, la cual recibe el vector, los valores de los cuantiles requeridos y se setea el parámetro names en falso para que solo se retorne el valor y no su porcentaje (por ejemplo, 25% y 75%). Luego se guardan los valores que se quieren retornar en una lista (usando list) haciendo una asignación de clave-valor que finalmente se retornará.

```{r}
values = c(7,5,9,2,1,8,3,4,6,10)
iqr <- function(v) {
  q1 = quantile(v,1/4,names = FALSE)
  q3 = quantile(v,3/4,names = FALSE)
  iqr_list=list("q1"=q1,"q3"=q3,"ext"=q3-q1)
  return (iqr_list);
}
iqr(values)
```

## 2. Distribuciones de probabilidad en R
### Describir la función de densidad de probabilidad, función de distribución acumulada y función cuantil
* **Funciones de densidad de probabilidad:** Las funciones de densidad de probabilidad describen la probabilidad de observar cierto valor dentro de una muestra dada. Estas funciones se dividen en distribuciones discretas y continuas; la primera solo toma valores positivos en un conjunto de posibles valores, mientras que la segunda acepta valores tanto positivos como negativos.
* **Función de distribución acumulada:** La función de distribución acumulada describe la probabilidad de que una variable dentro de una muestra obtenga un valor n.
* **Función cuantil de la distribución:** Se le conoce como la función inversa de la función de distribución acumulada, debido a que indica el valor de la variable aleatoria para el cual la probabilidad de que esa variable aleatoria sea menor o igual a dicho valor sea la probabilidad dada.

### ¿Qué funciones existen en R que permitan obtener valores asociadas a esas funciones?

Las funciones para la función de densidad, la función acumulativa y la función cuantil deben aplicarse sobre una distribución x, siendo **d**x, **p**x y **q**x respectivamente.

Estas distribuciones pueden ser:

#### Distribuciones Discretas:

**Binomial**: binom

**Poisson**: pois

**Geométrica**: geom

**Hipergeométrica**: hyper

**Binomial negativa**: nbinom

#### Distribuciones Continuas: 

**Uniforme**: unif

**Normal**: norm

**t student**: t

**F Fisher**: F

**Chi-Cuadrado**: chisq

**Exponencial**: exp

**Gamma**: gamma

**Weibull**: weibull

**W de Wilcoxon**: wilcox   


### Muestre estas funciones para 4 distribuciones de probabilidad diferentes (dos distribuciones de variables continuas y dos distribuciones de variables discretas). Use gráficas para visualizar dichas funciones.

#### Distribución Discreta

```{r setup}
x <- 1:80
par(mfrow = c(2, 3))
plot(dbinom(x, size = 80, prob = 0.2), type = "h", lwd = 2,
     main = "Densidad Binomial", ylab = "P(X = x)", xlab = "Número de éxitos", col = 'red')
plot(pbinom(x, size = 80, prob = 0.2), type = 'l',ylab = "P(X = x)",
     xlab = 'Número de éxitos', main = 'Acumulada Binomial', col = 'red')
plot(qbinom(seq(0, 1, 0.001), size = 80, prob = 0.2), type='l',lwd = 2,
     main = 'Cuantil Binomial', ylab = 'Número de éxitos', xlab = 'P(X = x)', col = 'red', xaxt = "n")
axis(1, labels = seq(0, 1, 0.1), at = 0:10 * 100)
lambda <- 5
plot(dpois(x, lambda), type = "h", lwd = 2,
     main = "Densidad Poisson",
     ylab = "P(X = x)", xlab = "Número de eventos", col = 'blue')
plot(ppois(x, lambda), type = "l", lwd = 2,
     main = "Acumulada Poisson",
     ylab = "P(X = x)", xlab = "Número de eventos", col = 'blue')
plot(qpois(seq(0, 1, 0.001), lambda), type = "l", lwd = 2,
     main = "Cuantil Poisson",
     ylab = "P(X = x)", xlab = "Número de eventos", col = 'blue', xaxt = "n")
axis(1, labels = seq(0, 1, 0.1), at = 0:10 * 100)

```

En las siguientes gráficas se logra observar la función de densidad, función acumulativa y función cuantil de 2 distribuciones discretas, siendo estas la **distribución binomial y la distribución Poisson.** 
Para estas distribuciones se inicia estableciendo un margen de valores en el eje x **(x <- 1:80)** y un lienzo para un total de 6 gráficas **(par(mfrow = c(2, 3)))**, posterior a esto, se grafican la función de densidad, función acumulativa y la función cuantil de una distribución binomial con un número de **80 ensayos** con una probabilidad de exito de **0.2** mediante **dbinom(...), pbinom(...) y qbinom(...)** respectivamente, despues se grafican la función de densidad, función acumulativa y la función cuantil de una distribución de Poisson con una media de **5 eventos** mediante **dpois(...), ppois(...) y qpois(...)** respectivamente. Dichas funciones serán aplicadas dentro de la función **plot()**, la cual permite el dibujo de estas.

#### Distribución continua

```{r}
par(mfrow = c(2, 3))
x <- seq(-4, 8, 0.1)
plot(x,dnorm(x, mean = 0, sd = 1), type = "l",
     ylim = c(0, 0.6), lwd = 2, col = "green",
     main = 'Densidad Normal', xlab = 'Número de éxitos', ylab = 'P(X = x)')
plot(x,pnorm(x, mean = 0, sd = 1), type = 'l',
     col = "green",main = 'Normal Acumulada', xlab = 'Número de éxitos', ylab = 'P(X = x)')
plot(qnorm(seq(0, 1, 0.001), mean = 0, sd = 1),
     type = 'l', xaxt = "n", col = "green",main = 'Cuantil Normal', ylab = 'Número de éxitos', xlab = 'P(X = x)')
axis(1, labels = seq(0, 1, 0.1), at = 0:10 * 100)

plot(x,dt(y,df = 5), type = 'l', col = "orange",
     main = 'Densidad T', xlab = 'Número de éxitos', ylab = 'P(X = x)')
plot(x,pt(y,df = 5), type = 'l', col = "orange",
     main = 'T acumulada', xlab = 'Número de éxitos', ylab = 'P(X = x)')
plot(qt(seq(0, 1, 0.001),df = 5), type = 'l', xaxt = "n", col = "orange",
     main = 'Cuantil T', ylab = 'Número de éxitos', xlab = 'P(X = x)')
axis(1, labels = seq(0, 1, 0.1), at = 0:10 * 100)
```

En las siguientes gráficas se logra observar la función de densidad, función acumulativa y función cuantil de 2 distribuciones continuas, siendo estas la **distribución normal y la distribución T-Student.** 
Para estas distribuciones se inicia estableciendo un margen de valores en el eje x **x <- seq(-4, 8, 0.1)** y un lienzo para un total de 6 gráficas **(par(mfrow = c(2, 3)))**, posterior a esto, se grafican la función de densidad, función acumulativa y la función cuantil de una distribución Normal con una **media de 0 y una desviación estandar de 1** mediante **dnorm(...), pnorm(...) y qnorm(...)** respectivamente, despues se grafican la función de densidad, función acumulativa y la función cuantil de una distribución T student con **5 grados de libertad** mediante **dt(...), pt(...) y qt(...)** respectivamente. Dichas funciones serán aplicadas dentro de la función **plot()**, la cual permite el dibujo de estas.

## 3. Investigando la construcción de los intervalos de confianza con el lenguaje de programación R
```{r}
data=read.table("abalone.data",sep=",")

eq_in_row <- function(matrix) {
  s=sum(apply(matrix, 2, function(a) length(unique(a))==1), na.rm = TRUE)
  return(s)
}

mu_ci <- function(x,dist,n_samples,n_obs,ci){
  media=mean(x);  cont=0;
  repeat{combined=replicate(n_samples,sample(x,size=n_obs))
    if(eq_in_row(combined)==0){break}}
  for (i in 1:n_samples){
    if (dist=='t'){
      z=t.test(combined[,i], conf.level = ci)
      if (media>=z$conf.int[1] & media<=z$conf.int[2]){cont=cont+1}}
    if(dist=='n'){
      z=confint(lm(combined[,i]~1),level=ci)
      if (media>=z[1] & media<=z[2]){cont=cont+1}}}
  return(cont/n_samples)
}
```

(a) Extraiga 10000 muestras, cada una de 20 registros (observaciones) de forma aleatoria con reemplazo. Use cada muestra para calcular un intervalo de confianza del 90% para estimar la media poblacional. Use la distribución t para calcular ese intervalo. Recuerde que para realizar el cálculo se desconoce la varianza poblacional ¿Para qué fracción de las muestras la verdadera media poblacional se encuentra dentro del intervalo de confianza definido?
```{r}
  a=mu_ci(data$V2,'t',10000,20,0.9); a
```


(b) Extraiga 10000 muestras, cada una de 10 registros (observaciones) de forma aleatoria con reemplazo. Use cada muestra para calcular un intervalo de confianza del 90% para estimar la media poblacional. Use la distribución t para calcular ese intervalo. Recuerde que para realizar el cálculo se desconoce la varianza poblacional ¿Para qué fracción de las muestras la verdadera media poblacional se encuentra dentro del intervalo de confianza definido?
```{r}
  b=mu_ci(data$V2,'t',10000,10,0.9); b
```
(c) Extraiga 10000 muestras, cada una de 10 registros (observaciones) de forma aleatoria con reemplazo. Use cada muestra para calcular un intervalo de confianza del 90% para estimar la media poblacional. Use una distribución normal (que NO se debería usar porque la muestra es demasiado pequeña!). Recuerde que para realizar el cálculo se desconoce la varianza poblacional ¿Para qué fracción de las muestras la verdadera media poblacional se encuentra dentro del intervalo de confianza definido?
```{r}
  c=mu_ci(data$V2,'n',10000,10,0.9); c
```
(d) Extraiga 10000 muestras, cada una de 3 registros (observaciones) de forma aleatoria con reemplazo. Use cada muestra para calcular un intervalo de confianza del 90% para estimar la media poblacional. Use la distribución t para calcular ese intervalo. Recuerde que para realizar el cálculo se desconoce la varianza poblacional ¿Para qué fracción de las muestras la verdadera media poblacional se encuentra dentro del intervalo de confianza definido?
```{r}
  d=mu_ci(data$V2,'t',10000,3,0.9); d
```

(e) Extraiga 10000 muestras, cada una de 3 registros (observaciones) de forma aleatoria con reemplazo. Use cada muestra para calcular un intervalo de confianza del 90% para estimar la media poblacional. Use una distribución normal (que NO se debería usar porque la muestra es demasiado pequeña!). Recuerde que para realizar el cálculo se desconoce la varianza poblacional ¿Para qué fracción de las muestras la verdadera media poblacional se encuentra dentro del intervalo de confianza definido?
```{r}
  e=mu_ci(data$V2,'n',10000,3,0.9); e
```

## 4. Conclusiones
